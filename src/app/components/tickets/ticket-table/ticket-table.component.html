<div class="ticket-table-container">
    <div>

        <!-- Tickets en los que esta trabajando (estado en tramite) -->
        <div class="first-pb">
            <p-progressBar *ngIf="loading" mode="indeterminate" [style]="{'height': '5px'}"></p-progressBar>
        </div>
        <p-panel header="Casos en los que estás trabajando">
            <h3 style="margin-bottom: 5px;">Tickets principales</h3>

            <p-table [paginator]="true" [rows]="3" dataKey="no_ticket" [value]="listaTareaEstadoColor"
                [tableStyle]="{'min-width': '50rem'}" responsiveLayout="stack" [breakpoint]="'960px'">
                <ng-template pTemplate="header">
                    <tr>
                        <th></th>
                        <th pSortableColumn="codigo" style="min-width: 50px;">Ticket <p-sortIcon
                                field="codigo"></p-sortIcon></th>
                        <th pSortableColumn="titulo_ticket" style="min-width: 230px;">Titulo <p-sortIcon
                                field="titulo_ticket"></p-sortIcon></th>

                        <th pSortableColumn="descripcionprioridad" style="min-width: 140px;">Prioridad <p-sortIcon
                                field="descripcionprioridad"></p-sortIcon></th>
                        <th pSortableColumn="descripcionestado" style="min-width: 150px;">Estado <p-sortIcon
                                field="descripcionestado"></p-sortIcon></th>
                        <th pSortableColumn="fechaasignacion" style="min-width: 150px;">Fecha Asignación <p-sortIcon
                                field="fechaasignacion"></p-sortIcon></th>
                        <th *ngIf="listaTareaEstadoColor.tiemporequerido" pSortableColumn="tiemporequerido"
                            style="min-width: 150px;">Fecha entrega <p-sortIcon field="tiemporequerido"></p-sortIcon>
                        </th>
                        <th *ngIf="!listaTareaEstadoColor.tiemporequerido" pSortableColumn="tiempooptimo"
                            style="min-width: 150px;">Fecha entrega <p-sortIcon field="tiempooptimo"></p-sortIcon> </th>
                        <th class="text-center">Acción</th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-tareaT let-expanded="expanded">
                    <tr>
                        <td>
                            <button (click)="tareaEscogidaEstadoColor(tareaT,expanded)" type="button" pButton pRipple
                                [pRowToggler]="tareaT" class="p-button-text p-button-rounded p-button-plain"
                                [icon]="expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'"></button>
                        </td>
                        <!-- <td></td> -->
                        <td>{{tareaT.codigo}}</td>
                        <td>{{tareaT.titulo_ticket}}</td>

                        <!-- <td>{{tareaT.descripciontarea}}</td> -->
                        <td>{{tareaT.descripcionprioridad}}</td>
                        <td><span class="{{tareaT.color }}"> {{tareaT.descripcionestado}}</span></td>
                        <!-- <td>{{tareaT.descripcionprioridad }}</td> -->
                        <td>{{formatTimestamp(tareaT.fechaasignacion)}}</td>
                        <td *ngIf="!tareaT.tiemporequerido">{{ formatTimestamp(tareaT.tiempooptimo) }}</td>
                        <td *ngIf="tareaT.tiemporequerido">{{ formatTimestamp(tareaT.tiemporequerido) }}</td>

                        <td>
                            <div style=" position: relative;" class="speeddial-linear-demo"><p-speedDial
                                    [model]="items2" showIcon="pi pi-ellipsis-h" direction="left"
                                    (onClick)="tareaEscogidaEnTramite(tareaT)"></p-speedDial></div>
                        </td>

                    </tr>

                </ng-template>

                <ng-template pTemplate="emptymessage">
                    <tr>
                        <td colspan="8">No estás trabajando en ninguna tarea.</td>
                    </tr>
                </ng-template>
                <!-- Expansion subtarea -->
                <!-- Expansion subtarea -->
                <ng-template pTemplate="rowexpansion" let-tareaT>
                    <tr>
                        <td class="row-expansion-container" colspan="8">
                            <p-progressBar [value]="tareaT.value"></p-progressBar>
                            <br>
                            <div class="row-expansion">
                                <p-table [value]="tareaT.subtasks" dataKey="idtarea">
                                    <ng-template pTemplate="header">
                    <tr>
                        <th pSortableColumn="codigo">Ticket</th>
                        <th pSortableColumn="titulosubtarea">Subtarea </th>
                        <th pSortableColumn="responsable">Responsable </th>
                        <th pSortableColumn="estado">Estado </th>
                        <th pSortableColumn="vencimiento">Fecha Entrega </th>
                        <!-- <th pSortableColumn="vencimiento">Vencimiento </th> -->
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-subtask>
                    <tr>
                        <td>{{subtask.codigo}}</td>
                        <td>{{subtask.titulo_tarea}}</td>
                        <td>{{subtask.nombres_tecnico ? subtask.nombres_tecnico : ' Sin Definir'}} </td>
                        <td>{{subtask.estado}}</td> <!-- Propiedad del estado -->
                        <td>{{ formatTimestamp(subtask.fechaentrega)}}</td>
                        <!-- <td><p-button type="button" icon="pi pi-search"></p-button></td> -->
                    </tr>
                </ng-template>
                <ng-template pTemplate="emptymessage">
                    <tr>
                        <td colspan="6">No existen subtareas para este ticket.</td>
                    </tr>
                </ng-template>
            </p-table>
    </div>
    </td>
    </tr>
    </ng-template>

    </p-table>
    <div class="card-footer small text-muted">Listado de {{listaTareaEstadoColor.length}} tickets.</div>

    <br>
    <h3 style="margin-bottom: 5px;">Tareas secundarias en las que estás trabajando</h3>

    <p-table [paginator]="true" [rows]="3" [value]="listaSubtareasEnTramite" [tableStyle]="{'min-width': '50rem'}"
        responsiveLayout="stack" [breakpoint]="'960px'">

        <ng-template pTemplate="header">
            <tr>
               
                <th pSortableColumn="codigo" style="min-width: 120px;">Ticket <p-sortIcon field="codigo"></p-sortIcon>
                </th>
                <th pSortableColumn="descripciontarea" style="min-width: 260px;">Descripcion subtarea <p-sortIcon
                        field="descripciontarea"></p-sortIcon></th>
                <th pSortableColumn="estado" style="min-width: 150px;">Estado <p-sortIcon field="estado"></p-sortIcon>
                </th>
                <!-- <th>Prioridad</th> -->
                <th pSortableColumn="fechaasignacion" style="min-width: 150px;">Fecha Asignación <p-sortIcon
                        field="fechaasignacion"></p-sortIcon></th>
                <th pSortableColumn="fechaentrega" style="min-width: 150px;">Fecha Entrega <p-sortIcon
                        field="fechaentrega"></p-sortIcon></th>
                <th class="text-center">Acción</th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-tareaA>
            <tr>
                <td>{{tareaA.codigo}}</td>
                <td>{{tareaA.titulo_tarea}}</td>
                <td>{{tareaA.estado}}</td>
                <!-- <td><span class="{{tareaA.descripcionprioridad }}"> {{tareaA.descripcionprioridad}}</span></td> -->
                <td>{{ formatTimestamp(tareaA.fecha_asignacion) }}</td>
                <td>{{ formatTimestamp(tareaA.fechaentrega) }}</td>
                <td>
                    <div style=" position: relative;" class="speeddial-linear-demo"><p-speedDial [model]="items3"
                            direction="left" showIcon="pi pi-ellipsis-h"
                            (onClick)="SubtareaEscogida(tareaA)"></p-speedDial>
                    </div>
                </td>

            </tr>
        </ng-template>
        <ng-template pTemplate="emptymessage">
            <tr>
                <td colspan="6">No tienes tareas secundarias.</td>
            </tr>
        </ng-template>
    </p-table>
    <div class="card-footer small text-muted">Listado de {{listaSubtareasEnTramite.length}} subtareas.</div>

 
    </p-panel>


    <br>

    <div class="second-pb">
        <p-progressBar *ngIf="loading2" mode="indeterminate" [style]="{'height': '5px'}"></p-progressBar>
    </div>
    <p-panel header="Casos asignados (recoge un ticket si quieres empezar a trabajar en él)">
        <p-table [paginator]="true" [rows]="3" [value]="listaTareasAsignado" [tableStyle]="{'min-width': '50rem'}"
            responsiveLayout="stack" [breakpoint]="'960px'">
            <ng-template pTemplate="header">
                <tr>
                
                    <th pSortableColumn="codigo" style="min-width: 120px;">Ticket <p-sortIcon field="tarea"></p-sortIcon>
                    </th>
                    <th pSortableColumn="titulo_tarea" style="min-width: 260px;">Descripcion tarea <p-sortIcon
                            field="titulo_tarea"></p-sortIcon></th>
                    <!-- <th>Estado</th> -->

                    <th pSortableColumn="descripcionprioridad" style="min-width: 140px;">Prioridad <p-sortIcon
                            field="descripcionprioridad"></p-sortIcon></th>
                    <th pSortableColumn="estado" style="min-width: 150px;">Estado <p-sortIcon
                            field="estado"></p-sortIcon></th>
                    <th pSortableColumn="fecha_creacion" style="min-width: 150px;">Fecha Creación<p-sortIcon
                            field="fecha_creacion"></p-sortIcon></th>
                    <th pSortableColumn="fecha_asignacion" style="min-width: 150px;">Fecha Asignación
                        <p-sortIcon field="fecha_asignacion"></p-sortIcon></th>
                    <th pSortableColumn="fechaentrega" style="min-width: 150px;">Fecha Entrega <p-sortIcon
                            field="fechaentrega"></p-sortIcon></th>
                    <th class="text-center">Acción</th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-tareaA>
                <tr>
                  
                    <td>{{tareaA.codigo}}</td>
                    <td>{{tareaA.titulo_tarea}}</td>
                    <td><span class="{{tareaA.prioridad }}"> {{tareaA.prioridad}}</span></td>
                    <td>{{tareaA.estado}}</td>

                    <td>{{ formatTimestamp(tareaA.fecha_creacion) }}</td>
                    <td>{{ formatTimestamp(tareaA.fecha_asignacion) }}</td>
                    <td>{{ formatTimestamp(tareaA.fechaentrega) }}</td>
                    <td>
                        <div style=" position: relative;" class="speeddial-linear-demo"><p-speedDial [model]="items4"
                                direction="left" showIcon="pi pi-ellipsis-h"
                                (onClick)="tareaEscogidaenAsignacion(tareaA)"></p-speedDial></div>
                    </td>

                </tr>
            </ng-template>
            <ng-template pTemplate="emptymessage">
                <tr>
                    <td colspan="7">No tienes tickets asignadas.</td>
                </tr>
            </ng-template>
        </p-table>
        <div class="card-footer small text-muted">Listado de {{listaTareasAsignado.length}} tickets.</div>
    </p-panel>

    <br>
    <p-panel header="Tareas secundarias rechazadas">
    <!-- Tareas rechazadas -->
    <h3 style="margin-bottom: 5px;">Tareas secundarias rechazadas</h3>
    <p-table [paginator]="true" [rows]="3" [value]="listaRejectSubtask" [tableStyle]="{'min-width': '50rem'}"
        responsiveLayout="stack" [breakpoint]="'960px'">
    
        <ng-template pTemplate="header">
            <tr>
            
                <th pSortableColumn="codigo" style="min-width: 120px;">Ticket <p-sortIcon field="codigo"></p-sortIcon>
                </th>
                <th pSortableColumn="descripciontarea" style="min-width: 260px;">Descripcion subtarea <p-sortIcon
                        field="descripciontarea"></p-sortIcon></th>
    
                <th pSortableColumn="descripcionestado" style="min-width: 150px;">Estado <p-sortIcon
                        field="descripcionestado"></p-sortIcon></th>
                <th pSortableColumn="fecha_asignacion" style="min-width: 150px;">Fecha Asignación <p-sortIcon
                        field="fecha_asignacion"></p-sortIcon></th>
                <th pSortableColumn="fecha_entrega" style="min-width: 150px;">Fecha Entrega <p-sortIcon
                        field="fecha_entrega"></p-sortIcon></th>
                <th class="text-center">Acción</th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-tareaA>
    
            <tr>
                <td>{{tareaA.codigo}}</td>
                <td>{{tareaA.titulo_tarea}}</td>
                <td>{{tareaA.estado}}</td>
    
                <td>{{ formatTimestamp(tareaA.fecha_asignacion) }}</td>
                <td>{{ formatTimestamp(tareaA.fecha_entrega) }}</td>
                <td>
                    <div style=" position: relative;" class="speeddial-linear-demo"><p-speedDial [model]="items5"
                            direction="left" showIcon="pi pi-ellipsis-h"
                            (onClick)="SubtareaRechazadaEscogida(tareaA)"></p-speedDial>
                    </div>
                </td>
    
            </tr>
        </ng-template>
        <ng-template pTemplate="emptymessage">
            <tr>
                <td colspan="7">No tienes tareas secundarias rechazadas.</td>
            </tr>
        </ng-template>
    </p-table>
    <div class="card-footer small text-muted">Listado de {{listaRejectSubtask.length}} subtareas rechazadas.</div>
    
    </p-panel>
<br>

</div>



</div>
<p-confirmDialog header="Tomar ticket" [acceptLabel]="'Sí'" [rejectLabel]="'No'"
    icon="pi pi-exclamation-triangle"></p-confirmDialog>
<!-- <router-outlet></router-outlet> -->

<p-dialog (onHide)="cerrarModalAsignacion()" [(visible)]="modalSubtarea" [modal]="true"
    [breakpoints]="{'960px': '75vw', '640px': '100vw'}" [style]="{width: '40vw'}">
    <ng-template pTemplate="header">
    </ng-template>
    <h2>¿Deseas crear una tarea secundaria al ticket #{{tareaEscogidaTramite.tarea}}?</h2>

    <h4>Descripción tarea secundaria</h4>

    <textarea rows="5" cols="30" pInputTextarea #numInput4="ngModel" placeholder="Ingrese descripción de tarea"
        name="descripcionsubtarea" [(ngModel)]="descripcionsubtarea" style="width: 100%; height: 8rem;"></textarea>


    <h4 class="asign">Asignar a usuario</h4>
    <p-dropdown [options]="listaUsuarios" [filter]="true" [filterBy]="'nombres'" name="listausuarios"
        [(ngModel)]="usuarioseleccionado" [ngModelOptions]="{ standalone: true }" placeholder="Seleccione un usuario"
        [optionValue]="listaUsuarios.nombres" appendTo="body" optionLabel="email">
        <ng-template let-option pTemplate="item">

            {{ option.email }} - {{ option.nombres }} {{option.apellidos}} - {{ option.sucursal }}
        </ng-template>
    </p-dropdown>

    <div class="footer_modal">
        <p-calendar [(ngModel)]="dateEntrega" dateFormat="yy-mm-dd" [maxDate]="maxDateValue" [minDate]="nextDay"
            placeholder="Fecha de entrega" appendTo="body" [disabledDates]="listaHolidays" [disabledDays]="[0,6]"
            [readonlyInput]="true" inputId="disabledays"></p-calendar>

        <div class="flex">

            <p-progressSpinner *ngIf="spinnerLoad3 == true" styleClass="custom-spinner" strokeWidth="7"
                [style]="{width: '25px', height: '25px'}" fill="var(--surface-ground)"
                animationDuration=".5s"></p-progressSpinner>

            <button pButton pRipple type="button" (click)="crearSubtarea()" class="p-button-rounded p-button-help"
                style="margin-right: 10px;"  [disabled]="!dateEntrega || !descripcionsubtarea || !usuarioseleccionado">Aceptar</button>
            <button pButton pRipple type="button" (click)="cerrarModalAsignacion()"
                class="p-button-rounded p-button-danger">Cancelar</button>
        </div>
    </div>
</p-dialog>

<!-- Dialog para ver destalles de tablas sin vistas -->


<p-dialog (onHide)="cerrarModalVerTarea()" [(visible)]="mostrarModalVerTarea" [modal]="true"
    [breakpoints]="{'960px': '75vw', '640px': '100vw'}" [style]="{width: '50vw'}">
    <ng-template pTemplate="header">
        <!-- Confirmation -->
    </ng-template>
    <h2>Ticket N° {{verTareaDialog.idtarea}}</h2>



    <ng-template pTemplate="content">

        <div class="spinner-container" *ngIf="loadingData">

            <p-progressSpinner strokeWidth="7" [style]="{width: '25px', height: '25px'}"></p-progressSpinner>
        </div>

        <table *ngIf="!loadingData" class="info-table">


            <tr>
                <th>Fecha de creación: </th>
                <td>{{formatTimestamp(verTareaDialog.fechaasignacion)}}</td>
            </tr>
            <tr>
                <th>Título: </th>
                <td>{{verTareaDialog.descripciontarea}}</td>
            </tr>
            <tr>
                <th>Agencia: </th>
                <td>{{verTareaDialog.nombresucursal}}</td>
            </tr>
            <tr>
                <th>Cliente: </th>
                <td>{{verTareaDialog.persona}}</td>
            </tr>
            <tr>
                <th>Identificación: </th>
                <td>{{verTareaDialog.identificacion}}</td>
            </tr>
            <tr>
                <th>Tipo de reclamo: </th>
                <td>{{verTareaDialog.tipoReclamo}}</td>
            </tr>
            <tr>
                <th>Tipo Comentario: </th>
                <td>{{verTareaDialog.tipoComentario !=''|| verTareaDialog.tipoComentario != undefined || verTareaDialog.tipoComentario != null ? verTareaDialog.tipoComentario : 'No existe comentarios para este ticket!'}}</td>
            </tr>
            <tr>
                <th>Descripción asunto: </th>
                <td>{{verTareaDialog.descripcionasunto}}</td>
            </tr>
            <tr>
                <th>Estado: </th>
                <td>{{verTareaDialog.estado}}</td>
            </tr>
            <tr>
                <th>Prioridad: </th>
                <td>{{verTareaDialog.prioridad}}</td>
            </tr>
            <tr *ngIf="verTareaDialog.estado !=='Abierto'">
                <th>Usuario responsable: </th>
                <td>{{verTareaDialog.usuarioasignado}}</td>
            </tr>
            <tr *ngIf="verTareaDialog.estado === 'Abierto'">
                <th>Usuario que creó ticket: </th>
                <td>{{verTareaDialog.usuarioqasigno}}</td>
            </tr>
            <tr *ngIf="verTareaDialog.estado !=='Abierto'">
                <th>Usuario que asignó: </th>
                <td>{{verTareaDialog.usuarioqasigno}}</td>
            </tr>
            <tr>
                <th>Fecha de entrega: </th>
                <td>{{formatTimestamp(verTareaDialog.fechaentrega)}}</td>
            </tr>
        </table>
    </ng-template>
    <ng-template pTemplate="footer">
        <button pButton pRipple type="button" (click)="cerrarModalVerTarea()" label="Cerrar"
            class="p-button-rounded p-button-danger"></button>
    </ng-template>

</p-dialog>

<!-- Dialog para ver destalles de tablas con vistas -->
<p-dialog (onHide)="cerrarModalVerTarea()" [(visible)]="mostrarModalVerTareaEnTramite" [modal]="true"
    [breakpoints]="{'960px': '75vw', '640px': '100vw'}" [style]="{width: '50vw'}">
    <h2>Ticket N° {{verTareaDialog.tarea}}</h2>

    <ng-template pTemplate="header">
    </ng-template>
    <ng-template pTemplate="content">
        <table class="info-table">


            <tr>
                <th>Fecha de creación: </th>
                <td>{{formatTimestamp(verTareaDialog.fechaasignacion)}}</td>
            </tr>
            <tr>
                <th>Título: </th>
                <td>{{verTareaDialog.titulo_ticket}}</td>
            </tr>
            <tr>
                <th>Agencia: </th>
                <td>{{verTareaDialog.agencia}}</td>
            </tr>
            <tr>
                <th>Cliente: </th>
                <td>{{verTareaDialog.client}}</td>
            </tr>
            <tr>
                <th>Tipo de reclamo: </th>
                <td>{{verTareaDialog.descripciontipoticket}}</td>
            </tr>
            <tr>
                <th>Tipo Comentario: </th>
                <td>{{verTareaDialog.descripciontipocomentario}}</td>
            </tr>
            <tr>
                <th>Descripción asunto: </th>
                <td>{{verTareaDialog.descripcionasunto}}</td>
            </tr>
            <tr>
                <th>Estado: </th>
                <td>{{verTareaDialog.descripcionestado}}</td>
            </tr>
            <tr>
                <th>Prioridad: </th>
                <td>{{verTareaDialog.descripcionprioridad}}</td>
            </tr>
            <tr>
                <th>Usuario responsable: </th>
                <td>{{verTareaDialog.usuario_asignado}}</td>
            </tr>
            <tr>
                <th>Usuario que asigno: </th>
                <td>{{verTareaDialog.usuario_asignador}}</td>
            </tr>
            <tr>
                <th>Fecha de entrega: </th>
                <td *ngIf="!verTareaDialog.tiemporequerido">{{formatTimestamp(verTareaDialog.tiempooptimo)}}</td>
                <td *ngIf="verTareaDialog.tiemporequerido">{{formatTimestamp(verTareaDialog.tiemporequerido)}}</td>
            </tr>
        </table>
    </ng-template>
    <ng-template pTemplate="footer">
        <button pButton pRipple type="button" (click)="cerrarModalVerTarea()" label="Cerrar"
            class="p-button-rounded p-button-danger"></button>
    </ng-template>
</p-dialog>


<!-- Asignar ticket a usuario -->
<p-dialog (onHide)="cerrarModalAsignacion()" [(visible)]="mostrarModalAsignacion" [modal]="true"
    [breakpoints]="{'960px': '75vw', '640px': '100vw'}" [style]="{width: '50vw'}">
    <ng-template pTemplate="header">
        <!-- Confirmation -->
    </ng-template>
    <h2>¿Deseas asignar ticket #{{subtareaRechazadaEscogida.tarea}}?</h2>
    <h4 class="asign">Título de ticket</h4>

    <textarea rows="5" cols="30" pInputTextarea #numInput4="ngModel" placeholder="Ingrese título del ticket"
        name="descripciontarea" [(ngModel)]="descripciontarea" style="width: 100%; height: 8rem;"></textarea>

    <h4 class="asign">Asignar a usuario</h4>

    <p-dropdown [options]="listaUsuarios" [filter]="true" [filterBy]="'nombres'" name="listausuarios"
        [(ngModel)]="usuarioseleccionado" [ngModelOptions]="{ standalone: true }" placeholder="Seleccione un usuario"
        [optionValue]="listaUsuarios.nombres" appendTo="body" optionLabel="email">
        <ng-template let-option pTemplate="item">

            {{ option.email }} - {{ option.nombres }} {{option.apellidos}} - {{ option.sucursal }}
        </ng-template>
    </p-dropdown>

    <ng-template pTemplate="footer">
        <div class="d-flex justify-content-between">

            <p-calendar [(ngModel)]="dateEntregaSecundaria" dateFormat="yy-mm-dd" [maxDate]="maxDateValueSecundarias"
            [minDate]="nextDay"  placeholder="Fecha de entrega"  appendTo="body" [disabledDates]="listaHolidays" [disabledDays]="[0,6]" [readonlyInput]="true" inputId="disabledays"></p-calendar>
            
            <div class="footer">
                <p-progressSpinner *ngIf="spinnerLoad3 == true" styleClass="custom-spinner" strokeWidth="7"
                    [style]="{width: '25px', height: '25px'}" fill="var(--surface-ground)"
                    animationDuration=".5s"></p-progressSpinner>
                <div>
                    <button pButton pRipple type="button" (click)="asignarTicket()" 
                        class="p-button-rounded p-button-help"  [disabled]="!dateEntregaSecundaria || !descripciontarea || !usuarioseleccionado">Aceptar</button>
                    <button pButton pRipple type="button" (click)="cerrarModalAsignacion()" 
                        class="p-button-rounded p-button-danger">Cancelar</button>
                </div>
            </div>
        </div>

    </ng-template>
</p-dialog>



<!-- <p-dialog (onHide)="cerrarModalAsignacion()" [(visible)]="mostrarModalRechazarAsignacion" [modal]="true" [breakpoints]="{'960px': '75vw', '640px': '100vw'}"> -->
<p-dialog (onHide)="cerrarModalAsignacion()" [(visible)]="mostrarModalRechazarAsignacion" [modal]="true"
    [breakpoints]="{'960px': '75vw', '640px': '100vw'}" [style]="{width: '40vw'}">
    <div>
        <h2>¿Desea rechazar la asignación?</h2>
        <div class="btn-group-register">
            <p-progressSpinner *ngIf="spinnerLoad3 == true" styleClass="custom-spinner" strokeWidth="7"
                [style]="{width: '25px', height: '25px'}" fill="var(--surface-ground)"
                animationDuration=".5s"></p-progressSpinner>

            <button type="button" class="btn btn-success" (click)="rechazarAsignacion()">Si</button>
            <button type="submit" class="btn btn-success" (click)="cerrarModalAsignacion()">No</button>
        </div>
    </div>
</p-dialog>


<!-- Modal reasignacion  -->

<p-dialog (onHide)="cerrarModalReasignacion()" [(visible)]="mostrarModalReasignacion" [modal]="true"
    [breakpoints]="{'960px': '75vw', '640px': '100vw'}" [style]="{width: '50vw'}">
    <div class="">

        <h2 class="asign text-center ">¿Deseas reasignar ticket #{{tareaEscogidaAsignada.tarea}}?</h2>
        <h4>Reasigne a un usuario</h4>
        <p-dropdown [options]="listaUsuarios" [filter]="true" [filterBy]="'nombres'" name="listausuarios"
            [(ngModel)]="usuarioseleccionado" [ngModelOptions]="{ standalone: true }"
            placeholder="Seleccione un usuario" [optionValue]="listaUsuarios.nombres" appendTo="body"
            optionLabel="email">
            <ng-template let-option pTemplate="item">

                {{ option.email }} - {{ option.nombres }} {{option.apellidos}} - {{ option.sucursal }}
            </ng-template>
        </p-dropdown>

        <div class="footer_modal">

            <p-progressSpinner *ngIf="spinnerLoad3 == true" styleClass="custom-spinner" strokeWidth="7"
                [style]="{width: '25px', height: '25px'}" fill="var(--surface-ground)"
                animationDuration=".5s"></p-progressSpinner>
            <button pButton pRipple type="button" (click)="reasignarTicket()" class="p-button-rounded p-button-help"
                label="Aceptar"></button>
            <button pButton pRipple type="button" (click)="cerrarModalReasignacion()"
                class="p-button-rounded p-button-danger" label="Cancelar"></button>

        </div>
    </div>

</p-dialog>


<!-- Dialog para aceptar asignacion de tarea -->

<p-dialog (onHide)="cerrarModalAceptarAsignacion()" [(visible)]="mostrarModalAceptarAsignacion" [modal]="true"
    [style]="{width: '40vw'}">


    <div *ngIf="activeIndexAssign == 0 ">
        <h2>¿Deseas aceptar asignación?</h2>
        <div class="btn-group-register">
            <button type="button" class="btn btn-success" (click)="tomartareaConf()">Si</button>
            <button type="submit" class="btn btn-success" (click)="aceptarAsignacionRechazada()">No</button>
        </div>
    </div>


    <div *ngIf="activeIndexAssign == 1 ">
        <h2>La fecha máxima de entrega es:</h2>
        <h2>{{ formatTimestamp(tareaEscogidaAsignada.fechaentrega) }}</h2>

        <h3 class="text-center">¿Desea extender la fecha de entrega?</h3>

        <div class="field">
            
            <p-calendar [(ngModel)]="date5" inputId="icon" [defaultDate]="maxDate" [disabledDates]="listaHolidays" [minDate]="minDate"  [disabledDays]="[0,6]"
                [maxDate]="maxDate" placeholder="Nueva fecha de entrega" dateFormat="yy/dd/mm" appendTo="body"
                
                (onSelect)="nuevaFechaActiva()"></p-calendar>
        </div>

        <div class="btn-group-register">
            <p-progressSpinner *ngIf="spinnerLoad3 == true" styleClass="custom-spinner" strokeWidth="7"
                [style]="{width: '25px', height: '25px'}" fill="var(--surface-ground)"
                animationDuration=".5s"></p-progressSpinner>

            <button [disabled]="showBotonCambiarFecha" style="background-color: #4e1e4f; border: 1px solid #4e1e4f"
                type="button" class="btn btn-dark" (click)="tomarTareaAsignadaCambioFecha()">Cambiar fecha</button>
            <button type="submit" class="btn btn-light" style="border: 1px solid #888888;"
                (click)="tomarTareaAsignada()">Mantener fecha</button>
        </div>

    </div>

    <div *ngIf="activeIndexAssign == 2 ">
        <h2>La fecha máxima de entrega es:</h2>
        <h2>{{ formatTimestamp(tareaEscogidaAsignada.fechaentrega) }}</h2>

        <div class="btn-group-register">
            <p-progressSpinner *ngIf="spinnerLoad3 == true" styleClass="custom-spinner" strokeWidth="7"
                [style]="{width: '25px', height: '25px'}" fill="var(--surface-ground)"
                animationDuration=".5s"></p-progressSpinner>

            <button type="submit" class="btn btn-dark" (click)="tomarTareaAsignada()">Aceptar</button>
        </div>
    </div>
    <!-- Comentario rechazo de asignación -->

    <div *ngIf="activeIndexAssign == 3 ">

        <h3>Detalle la razón por la que rechaza la asignación</h3>
        <textarea pInputTextarea [(ngModel)]="rejectAssignComment" name="rejectAssignComment" placeholder="Detalle.." id="rejectAssignComment"
            style="height: 6rem;" rows="4" cols="50"></textarea>

        <div class="d-flex justify-content-end " style="margin: 10px 0;">
            <div style="margin-right: 10px;">
                <p-progressSpinner *ngIf="spinnerLoad3 == true" styleClass="custom-spinner" strokeWidth="7"
            [style]="{width: '25px', height: '25px'}" fill="var(--surface-ground)"
            animationDuration=".5s"></p-progressSpinner>
            </div>
            <button pButton pRipple type="button" (click)="rechazarAsignacion()" [disabled]="!rejectAssignComment"
                class="p-button-rounded p-button-secondary" style="border: none; margin-right: 10px;">Guardar</button>
            <button pButton pRipple type="button" style="border: none;" (click)="cancelarRechazo()"
                class="p-button-rounded p-button-danger">Cancelar</button>
        </div>
    </div>


</p-dialog>



<!-- Dialogo para registrar actividades de subtarea -->

<p-dialog (onHide)="cerrarModalVerActividad()" header="Ticket secundario N° {{subtareaEscogida.tarea?subtareaEscogida.tarea:subtareaRechazadaEscogida.tarea}}"
    [(visible)]="mostrarModalRegistroActividadSubtarea" [modal]="true" [style]="{width: '50vw'}" [responsive]="true">

    <div *ngIf="activeIndexActivities == 0">
        <div *ngIf="subtareaEscogida.tarea" class="dropdown-wrapper">
            <span>Estado:</span>
            <p-dropdown class="{{estadosubtareaseleccionado.descripcionestado}}" (onChange)="cambiarEstadoSubtarea()"
                [options]="listaEstadosSubtareas" [(ngModel)]="estadosubtareaseleccionado" placeholder="Cambiar estado"
                optionLabel="descripcionestado" appendTo="body"></p-dropdown>
            <p-progressSpinner *ngIf="spinnerLoad2 == true" styleClass="custom-spinner" strokeWidth="7"
                [style]="{width: '25px', height: '25px'}" fill="var(--surface-ground)"
                animationDuration=".5s"></p-progressSpinner>

        </div>
        <div class="act">
            <div *ngIf="activeIndexForm == 0 ">

                <div class="dropdown-act">
                    <h3>Actividades Secundarias</h3>
                    <div *ngIf="subtareaEscogida.tarea">
                        <!-- <button pButton pRipple type="button"  class="p-button-text p-button-plain"><i class="fa-solid fa-ellipsis"></i></button> -->
                        <button pButton pRipple type="button" (click)="crearActividadSubtarea()"
                            pTooltip="Nueva Actividad" tooltipPosition="top" class="p-button-text p-button-plain"><i
                                class="fa-solid fa-plus"></i></button>
                    </div>
                </div>
                <p-table [paginator]="true" [rows]="3" [value]="listaActividadesSubtareas.task" responsiveLayout="stack"
                    [breakpoint]="'960px'">

                    <ng-template pTemplate="header">
                        <tr>
                            <th pSortableColumn="">Subtarea </th>
                            <th pSortableColumn="">Título </th>
                            <th pSortableColumn="">Descripción </th>
                            <th pSortableColumn="">Fecha creación </th>
                            <th pSortableColumn="">Usuario </th>

                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-actividad>

                        <tr>
                            <td>{{actividad.idseguimientotarea}}</td>
                            <td>{{actividad.tituloseguimientotarea}}</td>
                            <td>{{actividad.detalleresolucion}}</td>
                            <td>{{formatTimestamp(actividad.fechacreacion)}}</td>
                            <td>{{actividad.usuario}}</td>

                        </tr>
                    </ng-template>
                    <ng-template pTemplate="emptymessage">
                        <tr>
                            <td colspan="5">No tienes actividades registradas.</td>
                        </tr>
                    </ng-template>
                </p-table>
            </div>
        </div>
    </div>

    <br>
    <!-- MODAL FORMULARIO -->
    <div *ngIf="activeIndexForm == 1 ">
        <div class="container">
            <h2>Formulario de Resolución</h2>
            <form class="" #formulario="ngForm">
                <div class="grid-container">
                    <!-- Left Column -->
                    <div>
                        <div class="form-group">
                            <label for="descripcionResolucion">Descripción de Resolución</label>
                            <input id="descripcionResolucion" name="descripcionResolucion" class="form-control"
                                [(ngModel)]="descripcionresolucion" required>
                        </div>
                        <br>
                        <div class="form-group">
                            <label for="clasificacionResolucion">Clasificación de Resolución</label>
                            <p-dropdown id="clasificacionResolucion" [options]="listaClasificacionesResoluciones"
                                [(ngModel)]="clasificacionresolucionseleccionada"
                                placeholder="Seleccione una clasificacion de resolucion"
                                optionLabel="descripcionclasificacion" appendTo="body" name="clasificacionResolucion"
                                [style]="{'width':'100%'}"></p-dropdown>
                        </div>
                        <br>
                        <div class="form-group">
                            <label for="tipoResolucion">Tipo de Resolución</label>
                            <p-dropdown id="tipoResolucion" name="tipoResolucion" [options]="listaTipoResoluciones"
                                [(ngModel)]="tiporesolucionseleccionada" placeholder="Seleccione un tipo de resolucion"
                                optionLabel="descripciontiporesolucion" appendTo="body"
                                [style]="{'width':'100%'}"></p-dropdown>
                        </div>
                        <br>
                        <div class="form-group">
                            <label for="observacionMonto">Observación Monto</label>
                            <input id="observacionMonto" name="observacionMonto" class="form-control"
                                [(ngModel)]="observacionmonto">
                        </div>
                    </div>

                    <!-- Right Column -->
                    <div>
                        <div class="form-group">
                            <label for="monto">Monto</label>
                            <input type="number" id="monto" name="monto" class="form-control"
                                [(ngModel)]="montoresolucion">
                        </div>
                        <br>
                        <div class="form-group">
                            <label for="interesMonto">Interés Monto</label>
                            <input type="number" id="interesMonto" name="interesMonto" class="form-control"
                                [(ngModel)]="interesmontoresolucion">
                        </div>
                        <br>
                        <div class="form-group">
                            <label for="totalMonto">Total Monto</label>
                            <input type="number" id="totalMonto" name="totalMonto" class="form-control"
                                [value]="montoresolucion + interesmontoresolucion">
                        </div>
                    </div>
                </div>
                <br>
                <div class="buttons">
                    <p-button label="Enviar" (click)="guardarResolucion()" icon="pi pi-check"></p-button>
                    <p-button label="Atrás" (click)="regresarActividades()" style="margin-left: 10px;"
                        icon="pi pi-arrow-left"></p-button>
                </div>
            </form>
        </div>


    </div>

    <div *ngIf="activeIndexActivities == 1">
        <div *ngIf="registeractivity == 0">

            <h2>Registrar actividad</h2>

            <div>
                <label for="tituloactividad">Título de la Actividad</label>
                <textarea pInputTextarea [(ngModel)]="tituloactividad" placeholder="Ingrese título de la actividad"
                    id="tituloactividad" style="height: 4rem;" rows="4" cols="50"></textarea>
            </div>
            <br>
            <div>
                <label for="descripcionactividad">Descripción de la Actividad</label>
                <textarea pInputTextarea id="descripcionactividad" placeholder="Ingrese la descripción de la actividad"
                    [(ngModel)]="descripcionactividad" style="height: 8rem;" rows="4" cols="50"></textarea>
            </div>
            <br>
            <!-- <button pButton pRipple type="button" label="Primary"></button> -->
            <div class="flex-end">
                <button *ngIf="activeUpload == 0" pButton pRipple type="button" class="p-button-secondary"
                    icon="fa-solid fa-file-arrow-up" (click)="sendToUpload()" label="Subir Archivo"></button>
                <button *ngIf="activeUpload == 1" pButton pRipple type="button" icon="pi pi-times"
                    class="p-button-secondary" (click)="closeUpload()" label="Cancelar"></button>

            </div>


            <div class="flex">
                <p-progressSpinner *ngIf="spinnerLoad2 == true" styleClass="custom-spinner" strokeWidth="7"
                    [style]="{width: '25px', height: '25px'}" fill="var(--surface-ground)"
                    animationDuration=".5s"></p-progressSpinner>
                <button pButton pRipple type="button" (click)="cerrarModalVerActividad()" icon="pi pi-times"
                    label="Cancelar" class="p-button-secondary" style="background-color: #4e1e4f;"></button>
                <button pButton pRipple type="button" (click)="volverModalVerActividad()" icon="pi pi-arrow-left"
                    label="Atrás" class="p-button-secondary" style="background-color: #4e1e4f;"></button>
                <button pButton pRipple type="button" (click)="guardarActividadSubtarea()" icon="pi pi-save"
                    label="Guardar" class="p-button-secondary" style="background-color: #4e1e4f;"></button>
            </div>
        </div>

        <div *ngIf="activeUpload == 1">
            <h2>Subir archivo</h2>

            <div>
                <label for="activityFile">Descripción del Archivo</label>
                <input type="text" [(ngModel)]="descripcionArchivo" [style]="'width: 100%'"
                    placeholder="Descripción del archivo" id="nombreArchivo">
            </div>
            <br>
            <div>

                <label for="activityFile">Adjuntar Archivo</label>
                <p-fileUpload [files]="myfiles" name="activityFile" [customUpload]="true" [maxFileSize]="5242880"
                    accept=" application/pdf" (uploadHandler)="myUploaderTareaS($event)">

                </p-fileUpload>
            </div>
            <div class="flex">
                <p-progressSpinner *ngIf="spinnerLoad2 == true" styleClass="custom-spinner" strokeWidth="7"
                    [style]="{width: '25px', height: '25px'}" fill="var(--surface-ground)"
                    animationDuration=".5s"></p-progressSpinner>

                <!-- <button pButton pRipple type="button" (click)="cerrarModalVerActividad()" icon="pi pi-times" label="Cancelar" class="p-button-secondary" style="background-color: #4e1e4f;"></button> -->
                <button pButton pRipple type="button" (click)="volverModalCrearActividad()" icon="pi pi-arrow-left"
                    label="Atrás" class="p-button-secondary" style="background-color: #4e1e4f;"></button>
            </div>
        </div>

    </div>
</p-dialog>


<!-- Dialogo para registrar actividades de tareas principales -->

<p-dialog (onHide)="cerrarModalVerActividad()" header="Ticket N° {{tareaEscogidaTramite.tarea}}"
    [(visible)]="mostrarModalRegistroActividadTareaP" [modal]="true" [style]="{width: '50vw'}" [responsive]="true">

    <div *ngIf="activeIndexActivities == 0">
        <h1>{{tareaEscogidaTramite.titulo_ticket}}</h1>
        <div class="dropdown-wrapper">
            <span>Estado:</span>
            <p-dropdown [options]="listaEstadosTareasP" (onChange)="cambiarEstadoTareaP()"
                [(ngModel)]="estadotareaseleccionado" placeholder="Cambiar estado" optionLabel="descripcionestado"
                appendTo="body">

            </p-dropdown>

            <p-progressSpinner *ngIf="spinnerLoad2 == true" styleClass="custom-spinner" strokeWidth="7"
                [style]="{width: '25px', height: '25px'}" fill="var(--surface-ground)"
                animationDuration=".5s"></p-progressSpinner>


        </div>

        <div *ngIf="activeIndexForm == 0 ">
            <div class="dropdown-act">
                <h3>Actividades principales</h3>
                <div>
                    <!-- <button pButton pRipple type="button"  class="p-button-text p-button-plain"><i class="fa-solid fa-ellipsis"></i></button> -->
                    <button pButton pRipple type="button" (click)="crearActividadTareaP()" pTooltip="Nueva Actividad"
                        tooltipPosition="top" class="p-button-text p-button-plain"><i
                            class="fa-solid fa-plus"></i></button>
                </div>
            </div>
            <p-table [paginator]="true" [rows]="3" [value]="listaActividadesTareaP.task" responsiveLayout="stack"
                [breakpoint]="'960px'">

                <ng-template pTemplate="header">
                    <tr>
                        <th pSortableColumn="idseguimientotarea">Ticket </th>
                        <th pSortableColumn="tituloseguimientotarea">Título </th>
                        <th pSortableColumn="detalleresolucion">Descripción </th>
                        <th pSortableColumn="fechacreacion">Fecha Creación</th>
                        <th pSortableColumn="">Usuario</th>
                        <!-- <th>Archivos</th>  -->
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-actividad>

                    <tr>

                        <td>{{tareaEscogidaTramite.codigo}}</td>
                        <td>{{actividad.tituloseguimientotarea}}</td>
                        <td>{{actividad.detalleresolucion}}</td>
                        <td>{{formatTimestamp(actividad.fechacreacion)}}</td>
                        <td>{{actividad.usuario}}</td>
                        <!-- <td>
                            <ul>
                                <li *ngFor="let archivo of actividad.archivos">
                                    <a [href]="archivo.url">{{archivo.nombre}}</a>
                                </li>
                            </ul>
                        </td> -->

                        <!-- <td>
                            <ul>
                                <li class="spacer">
                                    <i class="fa-solid fa-file"></i>
                                    <a>h</a>
                                </li>
                            </ul>
                        </td> -->
                    </tr>
                </ng-template>
                <ng-template pTemplate="emptymessage">
                    <tr>
                        <td colspan="5">No tienes actividades principales.</td>
                    </tr>
                </ng-template>
            </p-table>
            <p-card [style]="{'width': '100vw'}">

                <!-- <ng-template pTemplate="header"> -->
                <h3>Actividades secundarias</h3>
                <!-- </ng-template> -->

                <p-table [value]="listaActividadesTareaPSubtareas" dataKey="subtask" [responsive]="true">

                    <ng-template pTemplate="body" let-product let-expanded="expanded">
                        <tr>
                            <td>
                                <button type="button" pButton pRipple [pRowToggler]="product"
                                    class="p-button-text p-button-rounded p-button-plain"
                                    [icon]="expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'"></button>
                            </td>
                            <td>{{product.subtask}}</td>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="rowexpansion" let-product>
                        <tr>
                            <td colspan="7">
                                <div class="p-3">
                                    <p-table [paginator]="true" [rows]="2" [value]="product.values" dataKey="id">
                                        <ng-template pTemplate="header">
                        <tr>
                            <th pSortableColumn="">Subtarea </th>
                            <th pSortableColumn="">Título </th>
                            <th pSortableColumn="">Descripción </th>
                            <th pSortableColumn="">Fecha creación </th>
                            <th pSortableColumn="">Usuario </th>

                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-order>
                        <tr>
                            <!-- <td>{{product.subtask}}</td> -->
                            <td>{{ order.codigo }}</td>

                            <td>{{order.tituloseguimientotarea}}</td>
                            <td>{{order.detalleresolucion}}</td>
                            <td>{{formatTimestamp(order.fechacreacion)}}</td>
                            <td>{{order.usuario}}</td>

                        </tr>
                    </ng-template>
                    <ng-template pTemplate="emptymessage">
                        <tr>
                            <td colspan="6">No existen actividades.</td>
                        </tr>
                    </ng-template>
                </p-table>
        </div>
        </td>
        </tr>
        </ng-template>
        </p-table>

        </p-card>

    </div>

    <br>
    <!-- MODAL FORMULARIO -->
    <div *ngIf="activeIndexForm == 1 ">
        <div class="container">
            <h2>Formulario de Resolución</h2>
            <form class="" #formulario="ngForm">
                <div class="grid-container">
                    <!-- Left Column -->
                    <div>
                        <div class="form-group">
                            <label for="descripcionResolucion">Descripción de Resolución</label>
                            <input id="descripcionResolucion" name="descripcionResolucion" class="form-control"
                                [(ngModel)]="descripcionresolucion" required>
                        </div>
                        <br>
                        <div class="form-group">
                            <label for="clasificacionResolucion">Clasificación de Resolución</label>
                            <p-dropdown id="clasificacionResolucion" [options]="listaClasificacionesResoluciones"
                                [(ngModel)]="clasificacionresolucionseleccionada"
                                placeholder="Seleccione una clasificacion de resolucion"
                                optionLabel="descripcionclasificacion" appendTo="body" name="clasificacionResolucion"
                                [style]="{'width':'100%'}"></p-dropdown>
                        </div>
                        <br>
                        <div class="form-group">
                            <label for="tipoResolucion">Tipo de Resolución</label>
                            <p-dropdown id="tipoResolucion" name="tipoResolucion" [options]="listaTipoResoluciones"
                                [(ngModel)]="tiporesolucionseleccionada" placeholder="Seleccione un tipo de resolucion"
                                optionLabel="descripciontiporesolucion" appendTo="body"
                                [style]="{'width':'100%'}"></p-dropdown>
                        </div>
                        <br>
                        <div class="form-group">
                            <label for="observacionMonto">Observación Monto</label>
                            <input id="observacionMonto" name="observacionMonto" class="form-control"
                                [(ngModel)]="observacionmonto">
                        </div>
                    </div>

                    <!-- Right Column -->
                    <div>
                        <div class="form-group">
                            <label for="monto">Monto</label>
                            <input type="number" id="monto" name="monto" class="form-control"
                                [(ngModel)]="montoresolucion">
                        </div>
                        <br>
                        <div class="form-group">
                            <label for="interesMonto">Interés Monto</label>
                            <input type="number" id="interesMonto" name="interesMonto" class="form-control"
                                [(ngModel)]="interesmontoresolucion">
                        </div>
                        <br>
                        <div class="form-group">
                            <label for="totalMonto">Total Monto</label>
                            <input type="number" id="totalMonto" name="totalMonto" class="form-control"
                                [value]="montoresolucion + interesmontoresolucion">
                        </div>
                    </div>
                </div>
                <br>
                <div class="buttons">
                    <p-button label="Enviar" (click)="guardarResolucion()" icon="pi pi-check"></p-button>
                    <p-button label="Atrás" (click)="regresarActividades()" style="margin-left: 10px;"
                        icon="pi pi-arrow-left"></p-button>
                </div>
            </form>
        </div>


    </div>
    </div>
    <div *ngIf="activeIndexActivities == 1">
        <div *ngIf="registeractivity == 0">
            <h2>Registrar actividad</h2>
            <div>
                <label for="tituloactividad">Título de la Actividad</label>
                <textarea pInputTextarea [(ngModel)]="tituloactividad" placeholder="Ingrese título de la actividad"
                    id="tituloactividad" style="height: 4rem;" rows="4" cols="50"></textarea>
            </div>
            <br>
            <div>
                <label for="descripcionactividad">Descripción de la Actividad</label>
                <textarea pInputTextarea id="descripcionactividad" placeholder="Ingrese la descripción de la actividad"
                    [(ngModel)]="descripcionactividad" style="height: 8rem;" rows="4" cols="50"></textarea>
            </div>
            <br>
            <!-- <button pButton pRipple type="button" label="Primary"></button> -->

            <div class="flex-end">
                <button *ngIf="activeUpload == 0" pButton type="button" class="p-button-secondary"
                    icon="fa-solid fa-file-arrow-up" (click)="sendToUpload()" label="Subir Archivo"></button>
                <!-- <button *ngIf="activeUpload == 1" pButton  type="button" icon="pi pi-times"  class="p-button-secondary" (click)="closeUpload()" label="Cancelar"></button> -->
            </div>

            <div class="flex">
                <p-progressSpinner *ngIf="spinnerLoad2 == true" styleClass="custom-spinner" strokeWidth="7"
                    [style]="{width: '25px', height: '25px'}" fill="var(--surface-ground)"
                    animationDuration=".5s"></p-progressSpinner>
                <button pButton pRipple type="button" (click)="cerrarModalVerActividad()" icon="pi pi-times"
                    label="Cancelar" class="p-button-secondary" style="background-color: #4e1e4f;"></button>
                <button pButton pRipple type="button" (click)="volverModalVerActividad()" icon="pi pi-arrow-left"
                    label="Atrás" class="p-button-secondary" style="background-color: #4e1e4f;"></button>
                <button pButton pRipple type="button" (click)="guardarActividadTareaPrincipal('crear')"
                    icon="pi pi-save" label="Guardar" class="p-button-secondary"
                    style="background-color: #4e1e4f;"></button>
            </div>
        </div>

        <div *ngIf="activeUpload == 1">
            <h2>Subir archivo</h2>

            <div>
                <label for="activityFile">Descripción del Archivo</label>
                <input type="text" [(ngModel)]="descripcionArchivo" [style]="'width: 100%'"
                    placeholder="Descripción del archivo" id="nombreArchivo">
            </div>
            <br>
            <div>
                <br>
                <label for="activityFile">Adjuntar Archivo</label>
                <p-fileUpload [files]="myfiles" name="activityFile" [customUpload]="true" accept=" application/pdf"
                    (uploadHandler)="myUploaderTareaP($event)"></p-fileUpload>
            </div>
            <div class="flex">
                <p-progressSpinner *ngIf="spinnerLoad2 == true" styleClass="custom-spinner" strokeWidth="7"
                    [style]="{width: '25px', height: '25px'}" fill="var(--surface-ground)"
                    animationDuration=".5s"></p-progressSpinner>

                <!-- <button pButton pRipple type="button" (click)="cerrarModalVerActividad()" icon="pi pi-times" label="Cancelar" class="p-button-secondary" style="background-color: #4e1e4f;"></button> -->
                <button pButton pRipple type="button" (click)="volverModalCrearActividad()" icon="pi pi-arrow-left"
                    label="Atrás" class="p-button-secondary" style="background-color: #4e1e4f;"></button>
            </div>
        </div>



    </div>
</p-dialog>


<!-- Modal para mostrar lista de archivos -->
<p-dialog (onHide)="cerrarModalAsignacion()" [(visible)]="mostrarModalArchivos" [modal]="true"
    [breakpoints]="{'960px': '75vw', '640px': '100vw'}" [style]="{width: '45vw'}">
    <div>
        <h2>Lista de documentos adjuntos</h2>

        <!-- Mostrar el spinner cuando los archivos se están cargando -->
        <div class="spinner-container">
            <p-progressSpinner *ngIf="cargandoArchivos" animationDuration=".5s" styleClass="custom-spinner"
                strokeWidth="7" [style]="{width: '25px', height: '25px'}"></p-progressSpinner>
        </div>

        <p-table [paginator]="true" [rows]="3" [value]="listaArchivos" *ngIf="!cargandoArchivos">
            <ng-template pTemplate="header">
                <tr>
                    <th style="min-width: 100px;">Archivo</th>
                    <th style="min-width: 200px;">Descripción</th>
                    <th style="min-width: 50px;">Ver</th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-formData>
                <tr>
                    <td>{{ formData.nombrearchivo }}</td>
                    <td>{{ formData.descripcionarchivo }}</td>
                    <td>
                        <div class="spacer_spinner">
                            <button pButton type="button" style="background-color: #6f2b70;" (click)="openPDF(formData)"
                                icon="pi pi-file-pdf"></button>
                            <p-progressSpinner *ngIf="formData.showspinner" strokeWidth="7"
                                [style]="{width: '25px', height: '25px'}"></p-progressSpinner>
                        </div>
                    </td>
                </tr>
            </ng-template>

            <ng-template pTemplate="emptymessage">
                <tr>
                    <td colspan="3">No hay archivos</td>
                </tr>
            </ng-template>
        </p-table>
    </div>
</p-dialog>



<!-- Dialog para ver destalles de tablas con vista VTAREAS -->
<p-dialog (onHide)="cerrarModalVerTarea()" [(visible)]="mostrarModalVerTareasSinAsignacion" [modal]="true"
    [breakpoints]="{'960px': '75vw', '640px': '100vw'}" [style]="{width: '50vw'}">
    <h2>Ticket N° {{verTareaDialog.tarea}}</h2>

    <ng-template pTemplate="header">
    </ng-template>
    <ng-template pTemplate="content">
        <table class="info-table">
            <tr>
                <th>Ticket principal:</th>
                <td>{{verTareaDialog.tareaprincipal}}</td>
            </tr>
            <tr>
                <th>Fecha de creación:</th>
                <td>{{formatTimestamp(verTareaDialog.fecha_asignacion)}}</td>
            </tr>
            <tr>
                <th>Título:</th>
                <td>{{verTareaDialog.titulo_tarea}}</td>
            </tr>
            <tr>
                <th>Agencia:</th>
                <td>{{verTareaDialog.sucursal}}</td>
            </tr>
            <tr>
                <th>Cliente:</th>
                <td>{{ verTareaDialog.nombre_cliente ?? '' }} {{ verTareaDialog.apellido_cliente ?? '' }}</td>
            </tr>
            <tr>
                <th>Tipo de reclamo:</th>
                <td>{{verTareaDialog.tipo_reclamo}}</td>
            </tr>
            <tr>
                <th *ngIf="verTareaDialog.tipo_comentario">Tipo Comentario:</th>
                <td *ngIf="verTareaDialog.tipo_comentario">{{verTareaDialog.tipo_comentario}}</td>
            </tr>
            <tr>
                <th *ngIf="verTareaDialog.descripcionasunto">Descripción asunto:</th>
                <td *ngIf="verTareaDialog.descripcionasunto">{{verTareaDialog.descripcionasunto}}</td>
            </tr>
            <tr>
                <th>Estado:</th>
                <td>{{verTareaDialog.estado}}</td>
            </tr>
            <tr>
                <th>Prioridad:</th>
                <td>{{verTareaDialog.prioridad}}</td>
            </tr>
            <!-- <tr>
                <th>Usuario responsable:</th>
                <td>{{verTareaDialog.usuario_asignado}}</td>
            </tr> -->
            <tr>
                <th>Usuario que creó el ticket:</th>
                <td>{{verTareaDialog.creador? verTareaDialog.creador : verTareaDialog.nombre_asignador}}</td>
            </tr>
            <tr *ngIf="verTareaDialog.fechaentrega || verTareaDialog.fecha_entrega">
                <th>Fecha de entrega:</th>
                <td>{{verTareaDialog.fechaentrega? formatTimestamp(verTareaDialog.fechaentrega) : formatTimestamp(verTareaDialog.fecha_entrega)}}</td>

            </tr>
        </table>
    </ng-template>
    <ng-template pTemplate="footer">
        <button pButton pRipple type="button" (click)="cerrarModalVerTarea()" label="Cerrar"
            class="p-button-rounded p-button-danger"></button>
    </ng-template>
</p-dialog>


<!-- message toast  -->
<p-toast></p-toast>